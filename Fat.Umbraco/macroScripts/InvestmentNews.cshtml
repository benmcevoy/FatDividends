@using umbraco.MacroEngines

@inherits DynamicNodeContext
@{
    var content = @Vega.USiteBuilder.ContentHelper.GetCurrentContent() as Fat.Umbraco.DocumentTypes.InvestmentNewsPage;
}

<div id="investmentNews">
    <section>
        <div>@Html.Raw(content.Content)</div>
        <ul id="newsEntries">
        </ul>
    </section>
</div>

<script type="text/javascript">
    google.load("feeds", "1");

    function feedLoaded(result) {
        if (!result.error) {
            $('#newsItemTemplate').tmpl(result.feed.entries).appendTo('#newsEntries');
        }
    }

    function OnLoad() {
        var feed = new google.feeds.Feed("http://www.abc.net.au/news/feed/51892/rss.xml");
        feed.load(feedLoaded);
    }

    google.setOnLoadCallback(OnLoad);
    
    function formatDate(date) {
        var value = new Date(date);
        return value.getDate() + '/' + (parseInt(value.getMonth() + 1)) + '/' + value.getFullYear();
    }
</script>

<script id="newsItemTemplate" type="text/x-jQuery-tmpl">
    <li class="newsitem"><a href="${link}" target="_blank" title="${title}">
        <div class="title">${title}</div>
        <div class="snippet">${contentSnippet}</div>
        <div class="date">${formatDate(publishedDate)}</div>
    </a></li>
</script>
